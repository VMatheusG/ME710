---
title: "chuva"
author: "Matheus"
output: html_document
---


##pacotes

```{r}
library(tidyverse)
library(magrittr)
library(ggmap)
library(dplyr)
library(readxl)
library(tidyr)
library(lubridate)
library(gridExtra)
###
library(sp)
library(gstat)
```

##Lendo os dados

```{r}
chuva <- read.csv("dados/pluieNA.novdec.csv",header = T)
estacao <- read.csv("dados/pluieStations.Practicum.csv",header = T,stringsAsFactors = F)
coord <- read_excel("dados/coord.xlsx")


names(chuva) <- c("n",estacao$nom) 
```
##mapa


```{r}
France <- qmap("languedoc-roussillon", zoom = 8, 
               color, maptype = "toner")

France +
geom_point(aes(x = lon, y = lat), 
           col = "red", 
           size = 2, 
           data = coord[c(36,37),]) +
  geom_point(aes(x = lon, y = lat), 
             col = "blue", 
             size = 2,
data = coord[c(1,3),]) +
  geom_point(aes(x = lon, y = lat), 
             col = "green", 
             size = 2, 
             data = coord[-c(1,3,36,37),]) 
```


##Series comparando regiao azul com vermelha

```{r}
chuva_amostra <- chuva[,c(2,4,37,38)] %>% 
  mutate(ano = rep(1975:1992,each = 6), 
         mes = rep(11:12,each = 3,times = 18),
         dia = rep(c(10,20,30),times = 36),
         data = ymd(paste0(ano,mes,dia))) %>%
  select(-ano,-mes,-dia) %>% 
  gather(regiao,obs,-data) %>% 
  mutate(rg = ifelse(regiao %in%
                       c("Carcassonne","Limoux"),"A","V"))

p1 <- 
chuva_amostra %>%
  filter(rg == "A") %>% 
  ggplot(aes(data,obs)) +
  geom_line(col = "blue") +
  theme(x = NULL)+
  facet_grid(.~regiao)

p2 <- 
chuva_amostra %>%
  filter(rg == "V") %>% 
  ggplot(aes(data,obs)) +
  geom_line(col = "red") +
  theme(x = NULL)+
  facet_grid(.~regiao)

grid.arrange(p1,p2)
```


##Krigging primeira parte

inicialmente estamos desconsiderando  o comportamento temporal dos dados, no caso estaremos considerando como variavel resposta a m√©dia do total de chuva em cada umas das cidades

```{r}
chuva_media <- apply(chuva[,-1],2,mean,na.rm = T) %>%
 { data.frame(chuva = .) } %>% bind_cols(coord) %>%
  mutate(nome = estacao$nom)


chuva_media %>% 
  ggplot(aes(lon, lat)) +
  geom_point(aes(size = chuva), 
             color = "blue",
             alpha = 0.5) + 
  ggtitle("media chuva por estacao") + 
  theme_bw()

```

##ajustando o variograma

```{r}
coordinates(chuva_media) <- ~ lon + lat
variograma <- variogram(chuva~1, chuva_media) 
plot(variograma)
fit <- fit.variogram(variograma, model = vgm("Mat"))
plot(variograma,fit)
```

